{% extends 'base_layout.html' %}

{% block title %}500 - Internal Server Error{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-red-900 to-rose-900 overflow-hidden relative flex items-center justify-center">
  <!-- Animated background elements -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute -top-20 -left-20 w-72 h-72 bg-red-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
    <div class="absolute top-1/3 -right-20 w-96 h-96 bg-rose-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
    <div class="absolute bottom-20 left-1/4 w-80 h-80 bg-pink-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"></div>
  </div>

  <!-- Floating error icons -->
  <div class="error-icons absolute inset-0 overflow-hidden pointer-events-none">
    {% for i in range(8) %}
    <div class="error-icon absolute text-red-300/30" style="
      font-size: {{ range(20, 50)|random }}px;
      top: {{ range(0, 100)|random }}%;
      left: {{ range(0, 100)|random }}%;
      animation: float {{ range(15, 30)|random }}s linear infinite;
      animation-delay: -{{ range(0, 15)|random }}s;
    ">⚠️</div>
    {% endfor %}
  </div>

  <!-- Main content -->
  <div class="relative z-10 w-full max-w-2xl px-4 py-12 sm:px-6 lg:px-8">
    <div class="glass-card bg-white/5 backdrop-blur-lg rounded-2xl shadow-xl overflow-hidden border border-white/10 p-8 text-center">
      <!-- Animated error number -->
      <div class="error-number mb-6">
        <span class="block text-9xl font-bold text-white">
          <span class="text-gradient bg-gradient-to-r from-red-400 to-pink-400 bg-clip-text text-transparent">
            5<span class="bounce">0</span>0
          </span>
        </span>
      </div>
      
      <!-- Error message with typing animation -->
      <h1 class="text-3xl font-bold text-white mb-4">
        <span class="typing-animation">Internal Server Error</span>
      </h1>
      
      <p class="text-lg text-red-100 mb-6">
        Oops! Something went wrong on our end. Our team has been notified and we're working to fix it.
      </p>
      
      <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
        <!-- Home button -->
        <a href="{{ url_for('home.index') }}" class="relative overflow-hidden group px-6 py-3 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl text-white font-medium shadow-lg transition-all duration-300 hover:shadow-xl hover:from-red-600 hover:to-pink-700 transform hover:scale-105">
          <span class="relative z-10 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
            </svg>
            Go Home
          </span>
          <span class="ripple"></span>
        </a>
        
        <!-- Refresh button -->
        <button onclick="window.location.reload()" class="relative overflow-hidden group px-6 py-3 bg-white/10 border border-white/20 rounded-xl text-white font-medium shadow-lg transition-all duration-300 hover:shadow-xl hover:bg-white/20 transform hover:scale-105">
          <span class="relative z-10 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 animate-spin hidden" id="refreshSpinner" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" id="refreshIcon" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
            </svg>
            Try Again
          </span>
          <span class="ripple"></span>
        </button>
      </div>
      
      <!-- Technical details (collapsible) -->
      <div class="mt-8 text-left">
        <button onclick="toggleErrorDetails()" class="text-red-200 hover:text-white text-sm font-medium flex items-center">
          <svg id="errorDetailsChevron" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 transform transition-transform" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
          Technical Details
        </button>
        
        <div id="errorDetails" class="mt-2 bg-black/20 rounded-lg p-4 text-red-100 text-sm font-mono overflow-hidden max-h-0 transition-all duration-300">
          <div class="opacity-0 transition-opacity duration-300">
            <p><span class="text-red-300">Error:</span> Internal Server Error (500)</p>
            <p><span class="text-red-300">Path:</span> {{ request.path }}</p>
           <p><span class="text-red-300">Time:</span> {{ now.strftime('%Y-%m-%d %H:%M:%S') }}</p>

            {% if error %}
              <p><span class="text-red-300">Details:</span> {{ error }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="text-center mt-8 text-red-200 text-sm">
      <p>Need immediate help? <a href="mailto:support@bha.com" class="text-white hover:underline">Contact our support team</a></p>
    </div>
  </div>
</div>

<style>
  /* Blob background animation */
  @keyframes blob {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(30px, -50px) scale(1.1); }
    66% { transform: translate(-20px, 20px) scale(0.9); }
  }
  
  /* Error icon floating animation */
  @keyframes float {
    0% { transform: translateY(0) translateX(0) rotate(0deg); }
    50% { transform: translateY(-20px) translateX(10px) rotate(10deg); }
    100% { transform: translateY(0) translateX(0) rotate(0deg); }
  }
  
  /* Bounce animation for zero */
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
  }
  
  /* Typing animation */
  @keyframes typing {
    from { width: 0; }
    to { width: 100%; }
  }
  
  /* Ripple effect */
  @keyframes ripple {
    0% { transform: scale(0); opacity: 1; }
    100% { transform: scale(4); opacity: 0; }
  }
  
  /* Text gradient animation */
  @keyframes textGradient {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
  }

  /* Applied animations */
  .animate-blob { animation: blob 7s infinite; }
  .animation-delay-2000 { animation-delay: 2s; }
  .animation-delay-4000 { animation-delay: 4s; }
  .error-icon { animation: float 20s infinite linear; }
  .bounce { 
    display: inline-block;
    animation: bounce 2s ease infinite; 
  }
  .typing-animation {
    display: inline-block;
    overflow: hidden;
    white-space: nowrap;
    animation: typing 1.5s steps(20, end);
  }
  .ripple {
    position: absolute;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.3);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
  }
  .text-gradient {
    background-size: 200% auto;
    animation: textGradient 3s linear infinite;
  }
  
  /* Glass card effect */
  .glass-card {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Add ripple effect to buttons
    document.querySelectorAll('a, button').forEach(button => {
      button.addEventListener('click', function(e) {
        // Create ripple
        const ripple = document.createElement('span');
        ripple.classList.add('ripple');
        
        // Position ripple
        const rect = this.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        ripple.style.width = ripple.style.height = `${size}px`;
        ripple.style.left = `${e.clientX - rect.left - size/2}px`;
        ripple.style.top = `${e.clientY - rect.top - size/2}px`;
        
        // Add ripple to button
        this.appendChild(ripple);
        
        // Remove ripple after animation
        setTimeout(() => {
          ripple.remove();
        }, 600);
      });
    });

    // Handle refresh button click
    document.querySelector('button[onclick="window.location.reload()"]').addEventListener('click', function() {
      const spinner = document.getElementById('refreshSpinner');
      const icon = document.getElementById('refreshIcon');
      
      spinner.classList.remove('hidden');
      icon.classList.add('hidden');
      this.disabled = true;
    });

    // Error reporting (example)
    if (navigator.onLine) {
      // Could send error report to backend here
      console.log('Error occurred:', window.location.href);
    }
  });

  function toggleErrorDetails() {
    const details = document.getElementById('errorDetails');
    const chevron = document.getElementById('errorDetailsChevron');
    
    if (details.classList.contains('max-h-0')) {
      details.classList.remove('max-h-0');
      details.classList.add('max-h-96', 'py-4');
      details.querySelector('div').classList.remove('opacity-0');
      chevron.classList.add('rotate-180');
    } else {
      details.classList.add('max-h-0');
      details.classList.remove('max-h-96', 'py-4');
      details.querySelector('div').classList.add('opacity-0');
      chevron.classList.remove('rotate-180');
    }
  }
</script>
{% endblock %}